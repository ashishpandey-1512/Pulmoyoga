<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PulmoYoga - Smart Spirometer & Yoga Integration Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        html {
            scroll-behavior: smooth;
        }
        .scroll-section {
            scroll-margin-top: 80px;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .breathing-animation {
            animation: breathe 4s ease-in-out infinite;
        }
        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .notification-slide {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        /* Spinner for ML prediction */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-lg">ü´Å</span>
                        </div>
                        <span class="ml-3 text-xl font-bold text-gray-800">PulmoYoga</span>
                    </div>
                    <div class="hidden md:ml-10 md:flex md:space-x-8">
                        <button onclick="scrollToSection('dashboard')" class="nav-btn text-blue-600 border-b-2 border-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-all duration-300">Dashboard</button>
                        <button onclick="scrollToSection('tests')" class="nav-btn text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-all duration-300">Spirometry</button>
                        <button onclick="scrollToSection('risk-assessment')" class="nav-btn text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-all duration-300">Risk Assessment</button>
                        <button onclick="scrollToSection('yoga')" class="nav-btn text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-all duration-300">Yoga</button>
                        <button onclick="scrollToSection('reports')" class="nav-btn text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium transition-all duration-300">Reports</button>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button onclick="toggleNotifications()" class="p-2 rounded-full text-gray-400 hover:text-gray-500 relative">
                            <span class="sr-only">View notifications</span>
                            üîî
                            <span id="notificationBadge" class="absolute -top-1 -right-1 h-4 w-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
                        </button>
                    </div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-sm font-medium" id="userInitials"></span>
                        </div>
                        <div class="hidden md:block ml-1">
                            <select id="userDropdown" onchange="switchUser()" class="w-auto text-sm border-none bg-transparent font-medium text-gray-700"></select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Notifications Panel -->
    <div id="notificationsPanel" class="hidden fixed top-16 right-4 w-80 bg-white rounded-lg shadow-xl border z-40">
        <div class="p-4 border-b">
            <h3 class="text-lg font-semibold text-gray-800">Notifications</h3>
        </div>
        <div class="max-h-96 overflow-y-auto">
            <div class="p-4 border-b hover:bg-gray-50">
                <div class="flex items-start space-x-3">
                    <div class="w-2 h-2 bg-red-500 rounded-full mt-2"></div>
                    <div>
                        <p class="text-sm font-medium text-gray-800">Spirometry Test Due</p>
                        <p class="text-xs text-gray-500">Your monthly test is scheduled for today</p>
                        <p class="text-xs text-gray-400">2 hours ago</p>
                    </div>
                </div>
            </div>
            <div class="p-4 border-b hover:bg-gray-50">
                <div class="flex items-start space-x-3">
                    <div class="w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                    <div>
                        <p class="text-sm font-medium text-gray-800">Yoga Session Completed</p>
                        <p class="text-xs text-gray-500">Great job on your breathing exercises!</p>
                        <p class="text-xs text-gray-400">1 day ago</p>
                    </div>
                </div>
            </div>
            <div class="p-4 hover:bg-gray-50">
                <div class="flex items-start space-x-3">
                    <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                    <div>
                        <p class="text-sm font-medium text-gray-800">FEV1 Improvement</p>
                        <p class="text-xs text-gray-500">Your lung function improved by 8%</p>
                        <p class="text-xs text-gray-400">3 days ago</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Dashboard Section -->
        <div id="dashboard" class="section scroll-section pb-16">
            <!-- Welcome Header -->
            <div class="gradient-bg rounded-xl p-8 mb-8 text-white">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold mb-2">Welcome back, <span id="welcomeName"></span>!</h1>
                        <p class="text-blue-100">Your respiratory health journey continues</p>
                    </div>
                    <div class="breathing-animation">
                        <div class="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <span class="text-4xl">ü´Å</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Latest FEV1</p>
                            <p class="text-2xl font-bold text-gray-900" id="latestFEV1">2.8L</p>
                            <p class="text-sm text-green-600">‚Üë 5% from last test</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <span class="text-green-600 text-xl">üìà</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Yoga Streak</p>
                            <p class="text-2xl font-bold text-gray-900">12 days</p>
                            <p class="text-sm text-blue-600">Keep it up!</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <span class="text-blue-600 text-xl">üßò</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Next Test</p>
                            <p class="text-2xl font-bold text-gray-900">Today</p>
                            <p class="text-sm text-orange-600">Due in 2 hours</p>
                        </div>
                        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                            <span class="text-orange-600 text-xl">‚è∞</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Health Score</p>
                            <p class="text-2xl font-bold text-gray-900">85/100</p>
                            <p class="text-sm text-green-600">Excellent</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <span class="text-purple-600 text-xl">‚≠ê</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Spirometry Trends -->
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Spirometry Trends (6 months)</h3>
                    <canvas id="spirometryChart" width="400" height="200"></canvas>
                </div>
                
                <!-- Yoga Progress -->
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Yoga Practice Progress</h3>
                    <canvas id="yogaChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-xl p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Activity</h3>
                <div class="space-y-4">
                    <div class="flex items-center space-x-4 p-4 bg-gray-50 rounded-lg">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                            <span class="text-green-600">‚úÖ</span>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Completed Anulom-Vilom session</p>
                            <p class="text-sm text-gray-500">15 minutes ‚Ä¢ Today at 8:30 AM</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4 p-4 bg-gray-50 rounded-lg">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-blue-600">üìä</span>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Spirometry test completed</p>
                            <p class="text-sm text-gray-500">FEV1: 2.8L, FVC: 3.5L ‚Ä¢ Yesterday</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4 p-4 bg-gray-50 rounded-lg">
                        <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                            <span class="text-purple-600">üéØ</span>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Weekly goal achieved</p>
                            <p class="text-sm text-gray-500">5/5 yoga sessions completed ‚Ä¢ 2 days ago</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Spirometry Tests Section -->
        <div id="tests" class="section scroll-section pt-20 pb-16">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Spirometry Tests</h2>
                <div class="flex space-x-4">
                    <button onclick="startNewTest()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                        Start New Test
                    </button>
                    <button onclick="uploadData()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium">
                        Upload Data
                    </button>
                </div>
            </div>

            <!-- Test Results -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <!-- Latest Test Results -->
                <div class="lg:col-span-2 bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Latest Test Results</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <p class="text-sm text-gray-600">FEV1</p>
                            <p class="text-xl font-bold text-green-600">2.8L</p>
                            <p class="text-xs text-green-600">‚úÖ Normal</p>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <p class="text-sm text-gray-600">FVC</p>
                            <p class="text-xl font-bold text-green-600">3.5L</p>
                            <p class="text-xs text-green-600">‚úÖ Normal</p>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg">
                            <p class="text-sm text-gray-600">FEV1/FVC</p>
                            <p class="text-xl font-bold text-yellow-600">0.80</p>
                            <p class="text-xs text-yellow-600">‚ö† Borderline</p>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <p class="text-sm text-gray-600">PEF</p>
                            <p class="text-xl font-bold text-green-600">450 L/min</p>
                            <p class="text-xs text-green-600">‚úÖ Normal</p>
                        </div>
                    </div>
                    <canvas id="flowVolumeChart" width="600" height="300"></canvas>
                </div>

                <!-- Test History -->
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Test History</h3>
                    <div class="space-y-3">
                        <div class="p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="viewTestDetails('test1')">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-gray-800">Oct 15, 2025</p>
                                    <p class="text-sm text-gray-500">FEV1: 2.8L</p>
                                </div>
                                <span class="text-green-600">‚úÖ</span>
                            </div>
                        </div>
                        <div class="p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="viewTestDetails('test2')">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-gray-800">Sep 12, 2025</p>
                                    <p class="text-sm text-gray-500">FEV1: 2.7L</p>
                                </div>
                                <span class="text-green-600">‚úÖ</span>
                            </div>
                        </div>
                        <div class="p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="viewTestDetails('test3')">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-gray-800">Aug 15, 2025</p>
                                    <p class="text-sm text-gray-500">FEV1: 2.6L</p>
                                </div>
                                <span class="text-yellow-600">‚ö†</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI-Powered Risk Assessment Section -->
        <div id="risk-assessment" class="section scroll-section pt-20 pb-16">
            <div class="bg-white rounded-xl p-6 shadow-sm">
                <h2 class="text-2xl font-bold text-gray-800 mb-1">AI-Powered Risk Assessment</h2>
                <p class="text-sm text-gray-500 mb-4">Enter your data to get an AI-driven analysis based on the NHANES dataset. This is not a medical diagnosis.</p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Input Form -->
                    <div id="ml-form">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="age" class="block text-sm font-medium text-gray-700">Age</label>
                                <input type="number" id="age" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., 55">
                            </div>
                            <div>
                                <label for="sex" class="block text-sm font-medium text-gray-700">Sex</label>
                                <select id="sex" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                            </div>
                            <div>
                                <label for="height" class="block text-sm font-medium text-gray-700">Height (cm)</label>
                                <input type="number" id="height" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., 175">
                            </div>
                             <!-- <div>
                                <label for="race" class="block text-sm font-medium text-gray-700">Race/Ethnicity</label>
                                <select id="race" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                    <option value="White">White</option>
                                    <option value="Black">Black</option>
                                    <option value="Mexican American">Mexican American</option>
                                    <option value="Other">Other/Asian/Hispanic</option>
                                </select>
                            </div> -->
                            <div>
                                <label for="fev1" class="block text-sm font-medium text-gray-700">FEV1 (L)</label>
                                <input type="number" step="0.01" id="fev1" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., 2.8">
                            </div>
                            <div>
                                <label for="fvc" class="block text-sm font-medium text-gray-700">FVC (L)</label>
                                <input type="number" step="0.01" id="fvc" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., 3.5">
                            </div>
                        </div>
                        <button onclick="runPrediction()" class="mt-6 w-full bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg font-medium">
                            Analyze My Results
                        </button>
                    </div>
                    <!-- Results Display -->
                    <div id="ml-results-container" class="flex items-center justify-center bg-gray-50 rounded-lg p-4">
                        <div id="ml-placeholder" class="text-center text-gray-500">
                            <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-2xl">üí°</span>
                            </div>
                            Your analysis results will appear here.
                        </div>
                        <div id="ml-loader" class="hidden spinner"></div>
                        <div id="ml-results" class="hidden w-full space-y-3">
                            <!-- Dynamic results will be injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Yoga Section -->
        <div id="yoga" class="section scroll-section pt-20 pb-16">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Yoga & Pranayama</h2>
                <button onclick="startYogaSession()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-medium">
                    Start Session
                </button>
            </div>

            <!-- Personalized Recommendations -->
            <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl p-8 mb-8 text-white">
                <h3 class="text-xl font-bold mb-4">Personalized Recommendations</h3>
                <p class="mb-4">Based on your latest spirometry results, here are your recommended exercises:</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white bg-opacity-20 rounded-lg p-4">
                        <h4 class="font-semibold mb-2">üå¨Ô∏è Anulom-Vilom</h4>
                        <p class="text-sm">Improves airflow and FEV1</p>
                        <p class="text-xs mt-2">15 min daily</p>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-lg p-4">
                        <h4 class="font-semibold mb-2">üí® Kapalabhati</h4>
                        <p class="text-sm">Enhances lung capacity</p>
                        <p class="text-xs mt-2">10 min daily</p>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-lg p-4">
                        <h4 class="font-semibold mb-2">üßò Bhramari</h4>
                        <p class="text-sm">Reduces respiratory stress</p>
                        <p class="text-xs mt-2">5 min daily</p>
                    </div>
                </div>
            </div>

            <!-- Yoga Exercises -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Anulom-Vilom Card -->
                <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold text-gray-800">Anulom-Vilom</h4>
                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Recommended</span>
                    </div>
                    <p class="text-gray-600 text-sm mb-4">
                        Alternate nostril breathing to improve airflow and balance respiratory function.
                    </p>
                    <div class="mb-4 rounded-xl overflow-hidden shadow">
                        <video class="w-full rounded-lg" controls controlslist="nodownload" preload="metadata" poster="videos/anulom-vilom-poster.jpg">
                            <source src="videos/anulom_vilom.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div class="mb-4">
                        <p class="text-sm text-gray-500 mb-2">Duration: 15 minutes</p>
                        <p class="text-sm text-gray-500 mb-2">Frequency: Daily</p>
                        <p class="text-sm text-gray-500">Difficulty: Beginner</p>
                    </div>
                    <button onclick="startExercise('anulom-vilom')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium transition">
                        Start Exercise
                    </button>
                </div>

                <!-- Kapalabhati Card -->
                <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold text-gray-800">Kapalabhati</h4>
                        <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">Intermediate</span>
                    </div>
                    <p class="text-gray-600 text-sm mb-4">Skull shining breath to strengthen diaphragm and increase lung capacity.</p>
                    <div class="mb-4 rounded-xl overflow-hidden shadow">
                        <video class="w-full rounded-lg" controls controlslist="nodownload" preload="metadata" poster="videos/kapalabhati-poster.jpg">
                            <source src="videos/kapalabhati.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div class="mb-4">
                        <p class="text-sm text-gray-500 mb-2">Duration: 10 minutes</p>
                        <p class="text-sm text-gray-500 mb-2">Frequency: Daily</p>
                        <p class="text-sm text-gray-500">Difficulty: Intermediate</p>
                    </div>
                    <button onclick="startExercise('kapalabhati')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium">
                        Start Exercise
                    </button>
                </div>

                <!-- Bhramari Card -->
                <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold text-gray-800">Bhramari</h4>
                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Relaxation</span>
                    </div>
                    <p class="text-gray-600 text-sm mb-4">Humming bee breath to calm the nervous system and reduce respiratory stress.</p>
                    <div class="mb-4 rounded-xl overflow-hidden shadow">
                        <video class="w-full rounded-lg" controls controlslist="nodownload" preload="metadata" poster="videos/bhramari-poster.jpg">
                            <source src="videos/bhramari.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div class="mb-4">
                        <p class="text-sm text-gray-500 mb-2">Duration: 5 minutes</p>
                        <p class="text-sm text-gray-500 mb-2">Frequency: 2x daily</p>
                        <p class="text-sm text-gray-500">Difficulty: Beginner</p>
                    </div>
                    <button onclick="startExercise('bhramari')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium">
                        Start Exercise
                    </button>
                </div>
            </div>

            <!-- Progress Tracking -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Weekly Progress</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Monday</span>
                            <div class="flex space-x-1">
                                <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                                <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                                <div class="w-6 h-6 bg-gray-200 rounded-full"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Tuesday</span>
                            <div class="flex space-x-1">
                                <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                                <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                                <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Today</span>
                            <div class="flex space-x-1">
                                <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-xs">‚úì</span>
                                </div>
                                <div class="w-6 h-6 bg-gray-200 rounded-full pulse-animation"></div>
                                <div class="w-6 h-6 bg-gray-200 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Adherence Score</h3>
                    <div class="text-center">
                        <div class="relative w-32 h-32 mx-auto mb-4">
                            <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 36 36">
                                <path class="text-gray-200" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                <path class="text-green-500" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="80, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-2xl font-bold text-gray-800">80%</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600">This week's completion rate</p>
                        <p class="text-xs text-green-600 mt-1">+5% from last week</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section scroll-section pt-20 pb-16">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Reports & Analytics</h2>
                <button onclick="generateReport()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium">
                    Generate Report
                </button>
            </div>

            <!-- Report Filters -->
            <div class="bg-white rounded-xl p-6 shadow-sm mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Report Filters</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2">
                            <option>Last 30 days</option>
                            <option>Last 3 months</option>
                            <option>Last 6 months</option>
                            <option>Last year</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Report Type</label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2">
                            <option>Comprehensive</option>
                            <option>Spirometry Only</option>
                            <option>Yoga Progress</option>
                            <option>Correlation Analysis</option>
                        </select>
                    </div>
                    <div id="patientFilter" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Patient</label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2">
                            <option>All Patients</option>
                            <option>John Patient</option>
                            <option>Jane Smith</option>
                            <option>Bob Johnson</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Format</label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2">
                            <option>PDF</option>
                            <option>Excel</option>
                            <option>CSV</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Sample Report Preview -->
            <div class="bg-white rounded-xl p-6 shadow-sm mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Latest Report Preview</h3>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                    <div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <span class="text-gray-400 text-2xl">üìÑ</span>
                    </div>
                    <h4 class="text-lg font-medium text-gray-800 mb-2">Comprehensive Health Report</h4>
                    <p class="text-gray-600 mb-4">Generated on December 15, 2024</p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="downloadReport()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            Download PDF
                        </button>
                        <button onclick="shareReport()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                            Share with Doctor
                        </button>
                    </div>
                </div>
            </div>

            <!-- Correlation Analysis -->
            <div class="bg-white rounded-xl p-6 shadow-sm mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Yoga Practice vs Spirometry Improvement</h3>
                <canvas id="correlationChart" width="800" height="400"></canvas>
                <div class="mt-4 p-4 bg-green-50 rounded-lg">
                    <p class="text-sm text-green-800">
                        <strong>Insight:</strong> Your FEV1 has improved by 8% over the past 3 months, correlating with 85% yoga practice adherence. 
                        Regular Anulom-Vilom practice shows the strongest correlation with improved airflow metrics.
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- Scroll to Top Button -->
    <button id="scrollToTop" class="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 opacity-0 invisible z-40">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>

    <!-- Exercise Modal -->
    <div id="exerciseModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4">
            <div class="flex flex-col md:flex-row gap-8">
                <div class="w-full md:w-1/2">
                    <video id="exerciseVideo" class="w-full rounded-lg" controls controlslist="nodownload">
                        <!-- Video source will be added dynamically by JavaScript -->
                    </video>
                </div>
                <div class="w-full md:w-1/2 text-center flex flex-col justify-center">
                    <h3 id="exerciseTitle" class="text-xl font-bold text-gray-800 mb-4">Anulom-Vilom</h3>
                    <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6 breathing-animation">
                        <span class="text-4xl">üßò</span>
                    </div>
                    <div id="exerciseTimer" class="text-3xl font-bold text-blue-600 mb-4">15:00</div>
                    <p id="exerciseInstruction" class="text-gray-600 mb-6">Close your right nostril with your thumb. Inhale through your left nostril...</p>
                    <div class="flex space-x-4">
                        <button id="pauseResumeBtn" onclick="pauseExercise(event)" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded-lg transition">
                            Pause
                        </button>
                        <button onclick="stopExercise()" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg">
                            Stop
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add New User Modal -->
    <div id="newUserModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">Add Patient</h3>
            <div class="space-y-4">
                <div>
                    <label for="newUserName" class="block text-sm font-medium text-gray-700">Patient Name</label>
                    <input type="text" id="newUserName" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., John Doe">
                </div>
                <div>
                    <label for="newUserSex" class="block text-sm font-medium text-gray-700">Sex</label>
                    <select id="newUserSex" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option>Male</option>
                        <option>Female</option>
                    </select>
                </div>
                 <div>
                    <label for="newUserAge" class="block text-sm font-medium text-gray-700">Age</label>
                    <input type="number" id="newUserAge" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., 55">
                </div>
                <div>
                    <label for="newUserWeight" class="block text-sm font-medium text-gray-700">Weight (kg)</label>
                    <input type="number" id="newUserWeight" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., 70">
                </div>
                 <div>
                    <label for="newUserHeight" class="block text-sm font-medium text-gray-700">Height (cm)</label>
                    <input type="number" id="newUserHeight" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., 175">
                </div>
            </div>
            <div class="flex space-x-4 mt-8">
                <button onclick="closeNewUserModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 rounded-lg">
                    Cancel
                </button>
                <button onclick="addNewUser()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg">
                    Add Patient
                </button>
            </div>
        </div>
    </div>


    <script>
        // --- Global State & Data ---
        let users = [
            { name: 'Vikas', role: 'patient', initials: 'VK', sex: 'Male', age: 45, weight: 78, height: 170 },
            { name: 'Dr. Smith', role: 'doctor', initials: 'DS' },
            { name: 'Admin', role: 'admin', initials: 'AD' }
        ];
        let currentUser = users[0];
        let currentSection = 'dashboard';
        let exerciseTimerInterval = null;
        let exerciseTimeLeft = 0;
        let exerciseInitialDuration = 0;

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            setupVideoEventListeners();
            populateUserDropdown();
            updateUserInterface();
        });

        // --- Navigation ---
        function scrollToSection(sectionName) {
            const section = document.getElementById(sectionName);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                updateActiveNavButton(sectionName);
                currentSection = sectionName;
            }
        }

        function updateActiveNavButton(activeSection) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                btn.classList.add('text-gray-700');
            });
            const buttons = document.querySelectorAll('.nav-btn');
            const sectionMap = {
                'dashboard': 0, 'tests': 1, 'risk-assessment': 2, 'yoga': 3, 'reports': 4
            };
            const activeIndex = sectionMap[activeSection];
            if (activeIndex !== undefined && buttons[activeIndex]) {
                buttons[activeIndex].classList.remove('text-gray-700');
                buttons[activeIndex].classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
            }
        }

        function handleScrollSpy() {
            const sections = document.querySelectorAll('.scroll-section');
            const scrollPosition = window.scrollY + 100; 
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.offsetHeight;
                const sectionId = section.getAttribute('id');
                if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                    if (currentSection !== sectionId) {
                        updateActiveNavButton(sectionId);
                        currentSection = sectionId;
                    }
                }
            });
        }
        window.addEventListener('scroll', handleScrollSpy);

        // --- User Management ---
        function populateUserDropdown() {
            const userDropdown = document.getElementById('userDropdown');
            userDropdown.innerHTML = ''; // Clear existing options
            
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.name;
                option.textContent = user.name;
                userDropdown.appendChild(option);
            });

            const addUserOption = document.createElement('option');
            addUserOption.value = 'addUser';
            addUserOption.textContent = '+ Add User';
            userDropdown.appendChild(addUserOption);
            
            userDropdown.value = currentUser.name;
        }

        function switchUser() {
            const userDropdown = document.getElementById('userDropdown');
            const selectedValue = userDropdown.value;

            if (selectedValue === 'addUser') {
                openNewUserModal();
                userDropdown.value = currentUser.name; // Reset dropdown
            } else {
                const foundUser = users.find(u => u.name === selectedValue);
                if (foundUser) {
                    currentUser = foundUser;
                    updateUserInterface();
                }
            }
        }

        function updateUserInterface() {
            document.getElementById('welcomeName').textContent = currentUser.name;
            document.getElementById('userInitials').textContent = currentUser.initials;
            const patientFilter = document.getElementById('patientFilter');
            if (currentUser.role === 'patient') {
                patientFilter.classList.add('hidden');
            } else {
                patientFilter.classList.remove('hidden');
            }
        }
        
        function openNewUserModal() {
            document.getElementById('newUserModal').classList.remove('hidden');
        }

        function closeNewUserModal() {
            document.getElementById('newUserModal').classList.add('hidden');
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserAge').value = '';
            document.getElementById('newUserWeight').value = '';
            document.getElementById('newUserHeight').value = '';
        }

        function addNewUser() {
            const nameInput = document.getElementById('newUserName');
            const sexInput = document.getElementById('newUserSex');
            const ageInput = document.getElementById('newUserAge');
            const weightInput = document.getElementById('newUserWeight');
            const heightInput = document.getElementById('newUserHeight');

            const newName = nameInput.value.trim();
            const newAge = ageInput.value;
            const newWeight = weightInput.value;
            const newHeight = heightInput.value;

            if (!newName || !newAge || !newWeight || !newHeight) {
                showNotification('Please fill out all fields.', 'error');
                return;
            }
            if (users.find(u => u.name.toLowerCase() === newName.toLowerCase())) {
                showNotification('A user with this name already exists.', 'error');
                return;
            }

            const initials = newName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
            
            const newUser = { 
                name: newName, 
                role: 'patient', 
                initials: initials,
                sex: sexInput.value,
                age: parseInt(newAge),
                weight: parseFloat(newWeight),
                height: parseFloat(newHeight)
            };
            users.push(newUser);
            currentUser = newUser;
            
            populateUserDropdown();
            updateUserInterface();
            closeNewUserModal();
            showNotification(`Patient '${newName}' added successfully!`, 'success');
        }


        // --- UI Components (Notifications, Modals) ---
        function toggleNotifications() {
            document.getElementById('notificationsPanel').classList.toggle('hidden');
        }
        
        document.getElementById('scrollToTop').addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
        window.addEventListener('scroll', () => {
             const scrollToTopBtn = document.getElementById('scrollToTop');
            if (window.scrollY > 300) {
                scrollToTopBtn.classList.remove('opacity-0', 'invisible');
                scrollToTopBtn.classList.add('opacity-100', 'visible');
            } else {
                scrollToTopBtn.classList.add('opacity-0', 'invisible');
                scrollToTopBtn.classList.remove('opacity-100', 'visible');
            }
        });

        // --- Spirometry & Reports ---
        function startNewTest() {
            showNotification('Starting new spirometry test...', 'info');
            setTimeout(() => {
                showNotification('Test completed successfully!', 'success');
                document.getElementById('latestFEV1').textContent = `${(2.6 + Math.random() * 0.4).toFixed(1)}L`;
            }, 3000);
        }

        function uploadData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv,.xlsx';
            input.onchange = (e) => {
                if (e.target.files[0]) showNotification(`Uploading ${e.target.files[0].name}...`, 'info');
            };
            input.click();
        }

        function generateReport() { showNotification('Generating report...', 'info'); }
        function downloadReport() { showNotification('Downloading report...', 'info'); }
        function shareReport() { showNotification('Sharing report...', 'info'); }
        function viewTestDetails(testId) { showNotification(`Loading details for ${testId}...`, 'info'); }

        // --- Yoga & Exercise Modal ---
        function startYogaSession() {
            showNotification('Starting guided yoga session...', 'info');
        }

        function startExercise(exerciseType) {
            const modal = document.getElementById('exerciseModal');
            const videoEl = document.getElementById('exerciseVideo');
            const pauseBtn = document.getElementById('pauseResumeBtn');
            const exercises = {
                'anulom-vilom': { title: 'Anulom-Vilom', duration: 15 * 60, instruction: 'Cycle through alternate nostril breathing.', videoSrc: 'videos/anulom_vilom.mp4' },
                'kapalabhati': { title: 'Kapalabhati', duration: 10 * 60, instruction: 'Perform forceful, short exhalations.', videoSrc: 'videos/kapalabhati.mp4' },
                'bhramari': { title: 'Bhramari', duration: 5 * 60, instruction: 'Hum like a bee while exhaling slowly.', videoSrc: 'videos/bhramari.mp4' }
            }; 
            const exercise = exercises[exerciseType];
            
            document.getElementById('exerciseTitle').textContent = exercise.title;
            document.getElementById('exerciseInstruction').textContent = exercise.instruction;
            exerciseTimeLeft = exercise.duration;
            exerciseInitialDuration = exercise.duration;
            
            videoEl.innerHTML = `<source src="${exercise.videoSrc}" type="video/mp4">`;
            videoEl.load();
            videoEl.play();

            updateExerciseTimer();
            modal.classList.remove('hidden');

            pauseBtn.textContent = 'Pause';
            pauseBtn.onclick = pauseExercise;
            
            exerciseTimerInterval = setInterval(() => {
                exerciseTimeLeft--;
                updateExerciseTimer();
                if (exerciseTimeLeft <= 0) stopExercise();
            }, 1000);
        }

        function updateExerciseTimer() {
            const minutes = Math.floor(exerciseTimeLeft / 60);
            const seconds = exerciseTimeLeft % 60;
            document.getElementById('exerciseTimer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function pauseExercise(event) {
            if (exerciseTimerInterval) {
                clearInterval(exerciseTimerInterval);
                exerciseTimerInterval = null;
                document.getElementById('exerciseVideo').pause();
                event.target.textContent = 'Resume';
                event.target.onclick = resumeExercise;
            }
        }

        function resumeExercise(event) {
            exerciseTimerInterval = setInterval(() => {
                exerciseTimeLeft--;
                updateExerciseTimer();
                if (exerciseTimeLeft <= 0) stopExercise();
            }, 1000);
            document.getElementById('exerciseVideo').play();
            event.target.textContent = 'Pause';
            event.target.onclick = pauseExercise;
        }

        function stopExercise() {
            const videoEl = document.getElementById('exerciseVideo');
            const wasRunning = !!exerciseTimerInterval;
            if (exerciseTimerInterval) {
                clearInterval(exerciseTimerInterval);
                exerciseTimerInterval = null;
            }
            document.getElementById('exerciseModal').classList.add('hidden');
            videoEl.pause();
            videoEl.innerHTML = "";
            videoEl.load();

            const elapsedTime = exerciseInitialDuration - exerciseTimeLeft;
            if (wasRunning && elapsedTime > 0) {
                const minutes = Math.floor(elapsedTime / 60);
                const seconds = elapsedTime % 60;
                const message = (exerciseTimeLeft <= 0) ? `Exercise completed! ${minutes}m ${seconds}s logged.` : `Exercise stopped. ${minutes}m ${seconds}s logged.`;
                const type = (exerciseTimeLeft <= 0) ? 'success' : 'info';
                showNotification(message, type);
            }
        }

        // --- Machine Learning Feature ---
        function runPrediction() {
            const age = parseFloat(document.getElementById('age').value);
            const sex = document.getElementById('sex').value;
            const height = parseFloat(document.getElementById('height').value);
            const race = document.getElementById('race').value;
            const fev1 = parseFloat(document.getElementById('fev1').value);
            const fvc = parseFloat(document.getElementById('fvc').value);

            if ([age, height, fev1, fvc].some(isNaN) || age <= 0 || height <= 0 || fev1 < 0 || fvc < 0) {
                showNotification('Please enter valid, positive numbers for all fields.', 'error');
                return;
            }

            document.getElementById('ml-placeholder').classList.add('hidden');
            document.getElementById('ml-results').classList.add('hidden');
            document.getElementById('ml-loader').classList.remove('hidden');

            setTimeout(() => {
                const prediction = predictDiseaseRisk({ age, sex, height, race, fev1, fvc });
                displayPredictionResults(prediction);
                document.getElementById('ml-loader').classList.add('hidden');
                document.getElementById('ml-results').classList.remove('hidden');
            }, 1500);
        }

        function predictDiseaseRisk(data) {
            const { age, sex, height, race, fev1, fvc } = data;
            const ratio = fvc > 0 ? fev1 / fvc : 0;
            let results = { obstruction: {}, restriction: {}, prism: {} };
            
            let predFVC; // Simplified NHANES III equations
            if (sex === 'Male') {
                if (race === 'White') predFVC = (0.0600 * height) - (0.0214 * age) - 4.650;
                else if (race === 'Black') predFVC = (0.0573 * height) - (0.0211 * age) - 4.360;
                else predFVC = (0.0526 * height) - (0.0289 * age) - 3.211;
            } else {
                if (race === 'White') predFVC = (0.0491 * height) - (0.0216 * age) - 3.590;
                else if (race === 'Black') predFVC = (0.0430 * height) - (0.0249 * age) - 2.650;
                else predFVC = (0.0395 * height) - (0.0250 * age) - 1.874;
            }
            const llnFVC = predFVC * 0.8; // Common approximation

            results.obstruction = (ratio < 0.70) ?
                { risk: 'High', details: `FEV1/FVC ratio is ${ratio.toFixed(2)} (< 0.70), suggesting an obstructive pattern.` } :
                { risk: 'Low', details: `FEV1/FVC ratio is ${ratio.toFixed(2)} (>= 0.70).` };

            if (fvc < llnFVC) {
                if (ratio >= 0.70) {
                    results.restriction = { risk: 'High', details: `FVC is ${fvc.toFixed(2)}L, below the lower limit of normal (${llnFVC.toFixed(2)}L).` };
                    results.prism = { risk: 'Low', details: 'No PRISm pattern indicated.' };
                } else {
                    results.restriction = { risk: 'Low', details: `Although FVC is low, the low FEV1/FVC ratio points towards obstruction or a mixed pattern.` };
                    results.prism = { risk: 'Moderate', details: `FVC is low (${fvc.toFixed(2)}L), but the FEV1/FVC ratio is normal. This pattern is known as PRISm.` };
                }
            } else {
                results.restriction = { risk: 'Low', details: `FVC is ${fvc.toFixed(2)}L, within the normal range.` };
                results.prism = { risk: 'Low', details: 'FVC is within the normal range.' };
            }
            return results;
        }

        function displayPredictionResults(prediction) {
            const resultsDiv = document.getElementById('ml-results');
            const { obstruction, restriction, prism } = prediction;
            const createResultHTML = (title, result) => {
                const riskClass = result.risk === 'High' ? 'red' : result.risk === 'Moderate' ? 'yellow' : 'green';
                const icon = result.risk === 'High' ? '‚ùó' : result.risk === 'Moderate' ? '‚ö†Ô∏è' : '‚úÖ';
                return `
                    <div class="border-l-4 p-4 bg-${riskClass}-100 border-${riskClass}-500 text-${riskClass}-700">
                        <div class="flex">
                            <div class="py-1"><span class="text-xl">${icon}</span></div>
                            <div class="ml-3">
                                <p class="font-bold">${title}: ${result.risk}</p>
                                <p class="text-sm">${result.details}</p>
                            </div>
                        </div>
                    </div>`;
            };
            resultsDiv.innerHTML = createResultHTML('Obstructive Pattern Risk', obstruction) +
                                   createResultHTML('Restrictive Pattern Risk', restriction) +
                                   createResultHTML('PRISm Indication', prism);
        }

        // --- General Utilities ---
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const typeClasses = {
                success: 'bg-green-500 text-white',
                error: 'bg-red-500 text-white',
                info: 'bg-blue-500 text-white'
            };
            notification.className = `fixed top-20 right-4 p-4 rounded-lg shadow-lg z-50 notification-slide ${typeClasses[type]}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
        
        function setupVideoEventListeners() {
            const videos = document.querySelectorAll('video');
            videos.forEach(video => {
                video.addEventListener('play', (event) => {
                    videos.forEach(otherVideo => {
                        if (otherVideo !== event.target) otherVideo.pause();
                    });
                });
            });
        }

        // --- Chart Initialization ---
        function initializeCharts() {
            new Chart(document.getElementById('spirometryChart').getContext('2d'), {
                type: 'line',
                data: { labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'], datasets: [{ label: 'FEV1 (L)', data: [2.4, 2.5, 2.6, 2.6, 2.7, 2.8], borderColor: 'rgb(59, 130, 246)', backgroundColor: 'rgba(59, 130, 246, 0.1)', tension: 0.4 }, { label: 'FVC (L)', data: [3.1, 3.2, 3.3, 3.3, 3.4, 3.5], borderColor: 'rgb(16, 185, 129)', backgroundColor: 'rgba(16, 185, 129, 0.1)', tension: 0.4 }] },
                options: { responsive: true, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: false, min: 2.0 } } }
            });
            new Chart(document.getElementById('yogaChart').getContext('2d'), {
                type: 'bar',
                data: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], datasets: [{ label: 'Sessions Completed', data: [4, 6, 5, 7], backgroundColor: 'rgba(147, 51, 234, 0.8)' }, { label: 'Target Sessions', data: [7, 7, 7, 7], backgroundColor: 'rgba(229, 231, 235, 0.8)' }] },
                options: { responsive: true, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: true, max: 8 } } }
            });
            new Chart(document.getElementById('flowVolumeChart').getContext('2d'), {
                type: 'line',
                data: { labels: [0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5], datasets: [{ label: 'Flow-Volume Curve', data: [0, 4.5, 7.2, 6.8, 5.1, 3.2, 1.8, 0], borderColor: 'rgb(239, 68, 68)', backgroundColor: 'rgba(239, 68, 68, 0.1)', tension: 0.4, fill: true }] },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { title: { display: true, text: 'Volume (L)' } }, y: { title: { display: true, text: 'Flow (L/s)' }, beginAtZero: true } } }
            });
            new Chart(document.getElementById('correlationChart').getContext('2d'), {
                type: 'scatter',
                data: { datasets: [{ label: 'FEV1 vs Yoga Adherence', data: [{x: 60, y: 2.4}, {x: 70, y: 2.5}, {x: 75, y: 2.6}, {x: 80, y: 2.6}, {x: 85, y: 2.7}, {x: 90, y: 2.8}], backgroundColor: 'rgba(59, 130, 246, 0.6)' }] },
                options: { responsive: true, plugins: { legend: { position: 'top' } }, scales: { x: { title: { display: true, text: 'Yoga Adherence (%)' }, min: 50, max: 100 }, y: { title: { display: true, text: 'FEV1 (L)' }, min: 2.0, max: 3.0 } } }
            });
        }
    </script>
</body>
</html>


